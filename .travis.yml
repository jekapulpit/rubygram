language: ruby

rvm:
- 2.6.0

node_js:
  - 10

services:
- postgresql
- elasticsearch

before_install:
- curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.17.3
- export PATH="$HOME/.yarn/bin:$PATH"

cache: yarn

script:
- cd server
- bundle install
- psql -c "create user alex with encrypted password 'qwerty123';" -U postgres
- psql -c "CREATE DATABASE rubygram_test;" -U postgres
- psql -c "GRANT ALL PRIVILEGES ON DATABASE rubygram_test to alex;" -U postgres
- psql -c "ALTER DATABASE rubygram_test OWNER TO alex;" -U postgres
- bundle exec rake db:migrate
- rspec ./spec/models
- rspec ./spec/services
- cd ../client
- yarn
